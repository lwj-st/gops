(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b66875f8"],{3639:function(e,t,a){"use strict";a("9c14")},"4bfa":function(e,t,a){"use strict";a.r(t);a("a450");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-dialog",{attrs:{title:"告警静默配置",visible:e.silenceVisable,width:"45%"},on:{"update:visible":function(t){e.silenceVisable=t},close:function(t){e.silenceVisable=!1}}},[t("el-divider"),t("el-form",{ref:"silenceConfig",attrs:{model:e.silenceConfig,"label-width":"120px"}},[t("el-form-item",{staticStyle:{width:"650px"},attrs:{label:"静默类型"}},[t("el-select",{staticStyle:{width:"150px"},attrs:{"value-key":"value",filterable:"",clearable:"",placeholder:"请选择告警类型"},on:{change:e.setProName},model:{value:e.silenceConfig.category,callback:function(t){e.$set(e.silenceConfig,"category","string"===typeof t?t.trim():t)},expression:"silenceConfig.category"}},e._l(e.categorys,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1),1===e.silenceConfig.category?t("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"静默规则"}},[t("el-input",{attrs:{disabled:e.ruleDisabled},model:{value:e.silenceConfig.value,callback:function(t){e.$set(e.silenceConfig,"value",t)},expression:"silenceConfig.value"}})],1):e._e(),3===e.silenceConfig.category?t("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"告警主机"}},[t("el-input",{attrs:{placeholder:"请输入主机名或主机ip,会静默主机基础监控和日志监控"},model:{value:e.silenceConfig.value,callback:function(t){e.$set(e.silenceConfig,"value",t)},expression:"silenceConfig.value"}})],1):e._e(),4===e.silenceConfig.category?t("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"告警标题"}},[t("el-input",{attrs:{placeholder:"请输入或复制钉钉告警标题中的关键字"},model:{value:e.silenceConfig.value,callback:function(t){e.$set(e.silenceConfig,"value",t)},expression:"silenceConfig.value"}})],1):e._e(),2===e.silenceConfig.category?t("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"告警级别"}},[t("el-select",{staticStyle:{width:"80px"},attrs:{"value-key":"value",filterable:"",clearable:"",placeholder:"请选择告警级别"},model:{value:e.silenceConfig.value,callback:function(t){e.$set(e.silenceConfig,"value","string"===typeof t?t.trim():t)},expression:"silenceConfig.value"}},e._l(e.levels,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.value}})})),1)],1):e._e(),5===e.silenceConfig.category?t("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"告警产品线"}},[t("el-cascader",{staticStyle:{width:"300px"},attrs:{options:e.nodes,props:{label:"title",value:"id",multiple:!1},clearable:""},on:{change:e.changPdlSetLogId},model:{value:e.currentNode,callback:function(t){e.currentNode=t},expression:"currentNode"}})],1):e._e(),t("el-form-item",{staticStyle:{width:"200px"},attrs:{label:"静默时间"}},[t("el-select",{staticStyle:{width:"200px"},attrs:{"value-key":"id",filterable:"",placeholder:"请选择静默时间"},model:{value:e.silenceConfig.timer,callback:function(t){e.$set(e.silenceConfig,"timer",t)},expression:"silenceConfig.timer"}},e._l(e.timers,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.timer}})})),1)],1),t("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"备注"}},[t("el-input",{model:{value:e.silenceConfig.mark,callback:function(t){e.$set(e.silenceConfig,"mark",t)},expression:"silenceConfig.mark"}})],1)],1),t("div",[t("el-button",{attrs:{type:"success",round:""},on:{click:e.create}},[e._v("创建")]),t("el-button",{on:{click:function(t){e.silenceVisable=!1}}},[e._v("取 消")])],1)],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.createSilenceHandler}},[e._v("配置告警静默")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.silenceData,"header-cell-style":{background:"#eef1f6",color:"#606266"}}},[t("el-table-column",{attrs:{prop:"value",label:"静默规则",align:"center"}}),t("el-table-column",{attrs:{prop:"category",label:"静默维度",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.category?t("span",[e._v("告警规则")]):e._e(),2===a.row.category?t("span",[e._v("告警等级")]):e._e(),3===a.row.category?t("span",[e._v("告警主机")]):e._e(),4===a.row.category?t("span",[e._v("告警标题")]):e._e(),5===a.row.category?t("span",[e._v("告警产品线")]):e._e(),6===a.row.category?t("span",[e._v("Prometheus")]):e._e(),7===a.row.category?t("span",[e._v("所有告警")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"timer",label:"静默时间(h)",align:"center",width:"150"}}),t("el-table-column",{attrs:{prop:"creater",label:"创建人",align:"center",width:"150"}}),t("el-table-column",{attrs:{prop:"mark",label:"备注",align:"center",width:"150"}}),t("el-table-column",{attrs:{prop:"created",label:"创建时间",sortable:"",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("formatTime")(t.row.created_at))+"\n          ")]}}])}),t("el-table-column",{attrs:{prop:"operate",label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.delSilenceHandler(a.$index,a.row)}}},[e._v("关闭静默")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-count":e.page_total,"page-size":e.page_size,"current-page":e.cur_page},on:{"current-change":e.silencePageHandler}})],1)],1)],1)],1)},i=[],r=(a("ac67"),a("1bc7"),a("32ea"),a("e186"),a("bff1")),l=a("a483"),s=a("7736");a("7b04");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={data:function(){return{silenceData:[],silenceConfig:{name:"",value:"",category:3,timer:1,mark:""},silenceVisable:!1,cur_page:1,page_size:20,page_total:1,ruleDisabled:!0,idx:-1,loading:!1,nodes:[],categorys:[{id:1,label:"告警规则",value:1,disabled:!0},{id:3,label:"告警主机",value:3,disabled:!1},{id:4,label:"告警主题",value:4,disabled:!1},{id:5,label:"告警产品线",value:5,disabled:!1},{id:2,label:"告警等级",value:2,disabled:!1},{id:6,label:"容器类告警",value:6,disabled:!1}],levels:[{id:1,name:"P0",value:"P0"},{id:2,name:"P1",value:"P1"},{id:3,name:"P2",value:"P2"}],timers:[{id:1,name:"1小时",timer:1},{id:3,name:"3小时",timer:3},{id:6,name:"6小时",timer:6},{id:12,name:"12小时",timer:12},{id:13,name:"24小时",timer:24},{id:14,name:"48小时",timer:48}]}},created:function(){this.getData()},computed:{data:function(){return{}}},watch:{"$route.query":{handler:function(){console.log("this.router:",this.$route.query.id),this.$route.query.rule&&(this.silenceConfig.value=this.$route.query.rule,void 0==this.silenceConfig.value?this.silenceVisable=!1:(this.silenceConfig.category=1,this.silenceVisable=!0)),this.$route.query.id&&(console.log("来自钉钉的静默请求"),this.maintain(this.$route.query.id))},immediate:!0}},methods:o(o({},Object(s["b"])(["getPrivNodes","getSilenceData","createSilence","deleteSilence","getSilenceRuleParam","getTreeMenus","getNodePathById"])),{},{getData:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.getTreeMenus();case 4:return t=JSON.parse(this.$store.state.treeMenus.data),this.nodes=t,e.next=8,this.getSilenceData({page:this.cur_page,pageSize:20});case 8:this.silenceData=this.$store.state.silenceData.data;case 9:return e.prev=9,this.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[1,,9,12]])})));function t(){return e.apply(this,arguments)}return t}(),create:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.createSilence(this.silenceConfig);case 2:return e.next=4,this.getSilenceData({page:this.cur_page,pageSize:this.page_size});case 4:this.silenceData=this.$store.state.silenceData.data,this.silenceVisable=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),createSilenceHandler:function(){this.silenceVisable=!0},notfiyParentChangeTab:function(){this.$emit("toParent","silence")},setProName:function(e){this.silenceConfig.value="",this.silenceConfig.mark="",6===e&&(this.silenceConfig.value="关闭所有prometheus告警")},delSilenceHandler:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.deleteSilence({id:a.id});case 2:return e.next=4,this.getSilenceData({page:this.cur_page,pageSize:this.page_size});case 4:this.silenceData=this.$store.state.silenceData.data;case 5:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),getNodePath:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getNodePathById({id:t});case 2:a=this.$store.state.nodePath.data,console.log("node_id:",t,a),this.silenceConfig.value=a;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),changPdlSetLogId:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:0!=t.length&&(a=t[t.length-1],this.getNodePath(a));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),maintain:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getSilenceRuleParam({id:t});case 2:a=this.$store.state.silenceRuleParam.data,this.$router.push({path:"/silence?rule="+a});case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),silencePageHandler:function(e){this.cur_page=e,this.getSilenceData({page:this.cur_page,pageSize:this.page_size})},global_search:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.globalSearch(t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()})},d=u,g=(a("3639"),a("0b56")),p=Object(g["a"])(d,n,i,!1,null,"77b7ef08",null);t["default"]=p.exports},"9c14":function(e,t,a){}}]);